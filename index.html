<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no"/>
<title>Infinite Tower Climber</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;touch-action:none}
body{background:#0a0a1a;display:flex;justify-content:center;align-items:center;height:100vh;overflow:hidden;font-family:Arial,sans-serif}
#gameWrapper{position:relative;width:400px;height:600px;max-width:100vw;max-height:100vh}
canvas{display:block;width:100%;height:100%;border-radius:12px;box-shadow:0 0 40px rgba(100,200,255,0.3)}
#ui{position:absolute;top:0;left:0;width:100%;padding:12px 16px;display:flex;justify-content:space-between;align-items:center;pointer-events:none}
#score{color:#fff;font-size:22px;font-weight:bold;text-shadow:0 0 10px #4af}
#floor{color:#aef;font-size:14px}
#jetpackBar{position:absolute;bottom:12px;left:16px;width:80px;height:10px;background:rgba(255,255,255,0.15);border-radius:5px;overflow:hidden}
#jetpackFill{height:100%;width:100%;background:linear-gradient(90deg,#4af,#08f);border-radius:5px;transition:width .1s}
#jetpackLabel{position:absolute;bottom:26px;left:16px;color:#4af;font-size:11px}
#overlay{position:absolute;inset:0;background:rgba(0,0,10,.85);display:flex;flex-direction:column;justify-content:center;align-items:center;border-radius:12px;color:#fff;gap:16px}
#overlay h1{font-size:32px;color:#4af;text-shadow:0 0 20px #4af}
#overlay p{font-size:13px;color:#9cf;text-align:center;max-width:280px;line-height:1.6}
.hint{font-size:12px;color:#667}
#startBtn{padding:14px 40px;background:linear-gradient(135deg,#4af,#08f);color:#fff;border:none;border-radius:30px;font-size:18px;font-weight:bold;cursor:pointer;box-shadow:0 0 20px rgba(68,170,255,.5)}
.controls-hint{display:flex;flex-direction:column;gap:6px;background:rgba(255,255,255,.05);padding:12px 20px;border-radius:10px}
.controls-hint div{font-size:12px;color:#8af}
</style>
</head>
<body>
<div id="gameWrapper">
  <canvas id="c"></canvas>
  <div id="ui">
    <div id="score">0</div>
    <div id="floor">Floor 1</div>
  </div>
  <div id="jetpackLabel">JETPACK</div>
  <div id="jetpackBar"><div id="jetpackFill"></div></div>
  <div id="overlay">
    <h1>TOWER CLIMBER</h1>
    <div class="controls-hint">
      <div>ðŸ‘‰ Slide left/right â€” Move</div>
      <div>ðŸ‘‡ Pull down &amp; release â€” Jump</div>
      <div>ðŸ‘†ðŸ‘† Double tap â€” Jetpack</div>
    </div>
    <button id="startBtn">PLAY</button>
    <div class="hint">Collect coins â€¢ Avoid falling!</div>
  </div>
</div>
<script>
const canvas=document.getElementById('c'),ctx=canvas.getContext('2d');
const W=400,H=600;
canvas.width=W;canvas.height=H;
let state='menu',score=0,floor=1,camY=0,frameId;
let particles=[],platforms=[];

/* â”€â”€ PLAYER â”€â”€ */
const PW=28,PH=36;
let p={};
function resetPlayer(){
  p={x:W/2-PW/2,y:H-120,vx:0,vy:0,onGround:false,
     jetpackFuel:1,jetpackOn:false,dir:1,animFrame:0,animTick:0,trail:[],dead:false};
}

/* â”€â”€ PLATFORMS â”€â”€ */
function makePlatform(x,y,w,type){
  const col=type==='moving'?'#a64':type==='crumble'?'#855':'#448';
  const np={x,y,w,h:14,type,col,
    mx:type==='moving'?(Math.random()<.5?1:-1)*(1+Math.random()):0,
    crumbling:false,crumbleTimer:0};
  np.coin=Math.random()<.35?{x:x+w/2-8,y:y-24,collected:false}:null;
  return np;
}
function generatePlatforms(startY){
  platforms=[];
  platforms.push(makePlatform(0,startY,W,'solid'));
  let y=startY-90;
  for(let i=0;i<60;i++){
    const t=Math.random()<.12?'moving':Math.random()<.08?'crumble':'solid';
    const pw=60+Math.random()*80;
    platforms.push(makePlatform(Math.random()*(W-pw-10)+5,y,pw,t));
    y-=70+Math.random()*60;
  }
}
function extendPlatforms(){
  const top=platforms[platforms.length-1];
  if(top&&top.y>camY-200){
    let y=top.y-70-Math.random()*60;
    for(let i=0;i<8;i++){
      const t=Math.random()<.12?'moving':Math.random()<.08?'crumble':'solid';
      const pw=60+Math.random()*80;
      platforms.push(makePlatform(Math.random()*(W-pw-10)+5,y,pw,t));
      y-=70+Math.random()*60;
    }
  }
}

/* â”€â”€ STARS â”€â”€ */
const STARS=Array.from({length:120},()=>({x:Math.random()*W,y:Math.random()*3000,r:Math.random()*1.5+.3,b:Math.random()}));

/* â”€â”€ TOUCH â”€â”€ */
let touch={active:false,startX:0,startY:0,curX:0,curY:0,lastTap:0,doubleTap:false,pullState:'idle',pullAmt:0};
const DEAD=8,PULL_T=30,SENS=0.18,MAX_V=9;

function touchCoords(e){
  const r=canvas.getBoundingClientRect();
  return{x:(e.changedTouches[0].clientX-r.left)*(W/r.width),
         y:(e.changedTouches[0].clientY-r.top)*(H/r.height)};
}
canvas.addEventListener('touchstart',e=>{
  e.preventDefault();
  const{x,y}=touchCoords(e);
  const now=Date.now();
  if(now-touch.lastTap<300)touch.doubleTap=true;
  touch.lastTap=now;
  touch.active=true;touch.startX=x;touch.startY=y;touch.curX=x;touch.curY=y;
  touch.pullState='idle';touch.pullAmt=0;
},{passive:false});
canvas.addEventListener('touchmove',e=>{
  e.preventDefault();
  const{x,y}=touchCoords(e);
  touch.curX=x;touch.curY=y;
  const dy=y-touch.startY;
  if(dy>PULL_T&&p.onGround){touch.pullState='pulling';touch.pullAmt=Math.min(dy-PULL_T,100);}
},{passive:false});
canvas.addEventListener('touchend',e=>{
  e.preventDefault();
  if(touch.pullState==='pulling'){touch.pullState='released';}
  touch.active=false;
},{passive:false});

/* â”€â”€ PARTICLES â”€â”€ */
function spawnP(x,y,col,n){
  for(let i=0;i<n;i++)particles.push({x,y,vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4-1,life:1,col});
}

/* â”€â”€ JUMP â”€â”€ */
function doJump(pullAmt){
  if(!p.onGround)return;
  p.vy=-(10+(pullAmt/100)*6);
  p.onGround=false;
  spawnP(p.x+PW/2,p.y+PH,'#4af',8);
}

/* â”€â”€ PHYSICS â”€â”€ */
function update(){
  if(p.dead)return;

  /* horizontal from touch slide */
  if(touch.active){
    const dx=touch.curX-touch.startX;
    if(Math.abs(dx)>DEAD){
      p.vx=Math.sign(dx)*Math.min(Math.abs(dx)*SENS,MAX_V);
      p.dir=Math.sign(dx);
    }
  }else{p.vx*=0.82;}

  /* jetpack double tap */
  if(touch.doubleTap){
    if(p.jetpackFuel>0)p.jetpackOn=!p.jetpackOn;
    touch.doubleTap=false;
  }
  if(p.jetpackOn){
    if(p.jetpackFuel>0){p.vy=Math.max(p.vy-0.7,-8);p.jetpackFuel-=0.007;spawnP(p.x+PW/2,p.y+PH,'#f80',1);}
    else p.jetpackOn=false;
  }

  /* refuel */
  p.jetpackFuel=Math.min(1,p.jetpackFuel+(p.onGround?0.006:0.001));

  /* pull release jump */
  if(touch.pullState==='released'){doJump(touch.pullAmt);touch.pullState='idle';touch.pullAmt=0;}

  /* gravity */
  if(!p.jetpackOn)p.vy=Math.min(p.vy+0.45,16);

  p.x+=p.vx;p.y+=p.vy;
  p.vx=Math.max(-MAX_V,Math.min(MAX_V,p.vx));
  if(p.x+PW<0)p.x=W;if(p.x>W)p.x=-PW;

  /* platform collision */
  p.onGround=false;
  for(const pl of platforms){
    if(pl.crumbling&&pl.crumbleTimer>30)continue;
    const inX=p.x+PW>pl.x+2&&p.x<pl.x+pl.w-2;
    if(inX&&(p.y+PH-p.vy)<=pl.y+pl.h&&(p.y+PH)>=pl.y&&p.vy>=0){
      p.y=pl.y-PH;p.vy=0;p.onGround=true;
      if(pl.type==='crumble'&&!pl.crumbling){pl.crumbling=true;}
      spawnP(p.x+PW/2,pl.y,'#6af',2);
    }
    if(pl.type==='moving'){pl.x+=pl.mx;if(pl.x<0||pl.x+pl.w>W)pl.mx*=-1;}
    if(pl.crumbling)pl.crumbleTimer++;
  }

  /* coins */
  platforms.forEach(pl=>{
    if(pl.coin&&!pl.coin.collected&&p.x<pl.coin.x+16&&p.x+PW>pl.coin.x&&p.y<pl.coin.y+16&&p.y+PH>pl.coin.y){
      pl.coin.collected=true;score+=10;spawnP(pl.coin.x+8,pl.coin.y+8,'#ff0',6);
    }
  });

  /* camera */
  const target=p.y-H*.45;
  if(target<camY)camY=target;
  floor=Math.max(1,Math.floor(-camY/80)+1);
  score=Math.max(score,floor*5);
  extendPlatforms();

  /* death */
  if(p.y>camY+H+100){p.dead=true;setTimeout(()=>{state='dead';showOverlay(true);},800);}

  /* particles */
  for(let i=particles.length-1;i>=0;i--){
    const pt=particles[i];pt.x+=pt.vx;pt.y+=pt.vy;pt.vy+=.1;pt.life-=.04;
    if(pt.life<=0)particles.splice(i,1);
  }
  p.animTick++;if(p.animTick%6===0)p.animFrame=(p.animFrame+1)%4;
}

/* â”€â”€ DRAW BG â”€â”€ */
function drawBG(){
  const t=Math.max(0,Math.min(1,-camY/5000));
  ctx.fillStyle=`rgb(${Math.round(10+t*30)},${Math.round(10+t*5)},${Math.round(26+t*60)})`;
  ctx.fillRect(0,0,W,H);
  STARS.forEach(s=>{
    const sy=((s.y-camY)%H+H)%H;
    ctx.globalAlpha=(.5+.5*Math.sin(Date.now()*.001*(s.b+.5)))*.8;
    ctx.fillStyle='#fff';ctx.beginPath();ctx.arc(s.x,sy,s.r,0,Math.PI*2);ctx.fill();
  });
  ctx.globalAlpha=1;
}

/* â”€â”€ DRAW PLATFORMS â”€â”€ */
function drawPlatforms(){
  platforms.forEach(pl=>{
    const py=pl.y-camY;
    if(py<-20||py>H+20)return;
    let alpha=pl.crumbling?1-pl.crumbleTimer/40:1;
    ctx.globalAlpha=Math.max(0,alpha);
    ctx.fillStyle='rgba(0,0,0,.3)';ctx.beginPath();ctx.roundRect(pl.x+3,py+4,pl.w,pl.h,6);ctx.fill();
    ctx.fillStyle=pl.col;ctx.beginPath();ctx.roundRect(pl.x,py,pl.w,pl.h,6);ctx.fill();
    ctx.fillStyle='rgba(255,255,255,.15)';ctx.beginPath();ctx.roundRect(pl.x+4,py+2,pl.w-8,4,3);ctx.fill();
    ctx.globalAlpha=1;
    if(pl.coin&&!pl.coin.collected){
      const cy=pl.coin.y-camY+Math.sin(Date.now()*.004)*3;
      ctx.fillStyle='#FFD700';ctx.beginPath();ctx.arc(pl.coin.x+8,cy+8,7,0,Math.PI*2);ctx.fill();
      ctx.fillStyle='#FFA500';ctx.beginPath();ctx.arc(pl.coin.x+8,cy+8,4,0,Math.PI*2);ctx.fill();
    }
  });
}

/* â”€â”€ DRAW PLAYER (astronaut shape) â”€â”€ */
function drawPlayer(){
  if(p.dead)return;
  const px=p.x,py=p.y-camY;
  const flip=p.dir===-1;
  ctx.save();
  if(flip){ctx.scale(-1,1);ctx.translate(-W,0);}
  const dx=flip?W-px-PW:px;

  /* jetpack trail */
  if(p.jetpackOn)p.trail.push({x:px+PW/2,y:py+PH,life:1});
  p.trail=p.trail.filter(t=>t.life>0);
  p.trail.forEach(t=>{
    const tx=flip?W-t.x:t.x;
    ctx.globalAlpha=t.life*.4;ctx.fillStyle='#f80';
    ctx.beginPath();ctx.arc(tx,t.y,6*t.life,0,Math.PI*2);ctx.fill();
    t.life-=.06;
  });ctx.globalAlpha=1;

  /* jetpack pack */
  ctx.fillStyle=p.jetpackOn?'#f80':'#557';
  ctx.beginPath();ctx.roundRect(dx-6,py+6,8,16,3);ctx.fill();
  if(p.jetpackOn){
    ctx.fillStyle='#ff4';ctx.beginPath();
    ctx.moveTo(dx-2,py+22);ctx.lineTo(dx-7,py+32);ctx.lineTo(dx+3,py+28);ctx.closePath();ctx.fill();
  }

  /* legs */
  const lg=p.onGround?Math.sin(p.animFrame*Math.PI/2)*5:0;
  ctx.fillStyle='#3af';ctx.beginPath();ctx.roundRect(dx+5,py+22,7,14+lg,4);ctx.fill();
  ctx.beginPath();ctx.roundRect(dx+16,py+22,7,14-lg,4);ctx.fill();
  /* boots */
  ctx.fillStyle='#148';
  ctx.beginPath();ctx.roundRect(dx+3,py+30,10,6,3);ctx.fill();
  ctx.beginPath();ctx.roundRect(dx+15,py+30,10,6,3);ctx.fill();
  /* body */
  const bg=ctx.createLinearGradient(dx,py,dx+PW,py+24);
  bg.addColorStop(0,'#5cf');bg.addColorStop(1,'#28a');
  ctx.fillStyle=bg;ctx.beginPath();ctx.roundRect(dx+2,py+8,PW-4,18,6);ctx.fill();
  ctx.fillStyle='#1a6';ctx.fillRect(dx+2,py+20,PW-4,4);
  /* arms */
  const arm=p.onGround?Math.sin(p.animFrame*Math.PI/2)*4:p.jetpackOn?-8:0;
  ctx.fillStyle='#5cf';
  ctx.beginPath();ctx.roundRect(dx-4,py+10+arm,8,12,4);ctx.fill();
  ctx.beginPath();ctx.roundRect(dx+PW-4,py+10-arm,8,12,4);ctx.fill();
  /* helmet */
  ctx.fillStyle='#fff';ctx.beginPath();ctx.arc(dx+PW/2,py+7,11,0,Math.PI*2);ctx.fill();
  /* visor */
  ctx.fillStyle='rgba(80,200,255,.7)';ctx.beginPath();ctx.ellipse(dx+PW/2,py+8,7,6,0,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='rgba(255,255,255,.8)';ctx.beginPath();ctx.ellipse(dx+PW/2-2,py+5,3,2,-.3,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='rgba(0,40,80,.6)';ctx.beginPath();
  ctx.arc(dx+PW/2-3,py+8,2,0,Math.PI*2);ctx.arc(dx+PW/2+3,py+8,2,0,Math.PI*2);ctx.fill();
  ctx.restore();
}

function drawParticles(){
  particles.forEach(pt=>{
    ctx.globalAlpha=pt.life;ctx.fillStyle=pt.col;
    ctx.beginPath();ctx.arc(pt.x,pt.y-camY,3*pt.life,0,Math.PI*2);ctx.fill();
  });ctx.globalAlpha=1;
}
function drawPullIndicator(){
  if(touch.pullState==='pulling'){
    const cx=p.x+PW/2,cy=p.y-camY,s=touch.pullAmt/100;
    ctx.globalAlpha=.6;ctx.strokeStyle='#4af';ctx.lineWidth=2;ctx.setLineDash([4,4]);
    ctx.beginPath();ctx.moveTo(cx,cy+PH);ctx.lineTo(cx,cy+PH+40*s+10);ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle=`hsl(${200-s*120},90%,60%)`;ctx.fillRect(cx-20,cy-12,40*s,6);
    ctx.strokeStyle='#aaa';ctx.strokeRect(cx-20,cy-12,40,6);ctx.globalAlpha=1;
  }
}
function updateHUD(){
  document.getElementById('score').textContent=score;
  document.getElementById('floor').textContent='Floor '+floor;
  document.getElementById('jetpackFill').style.width=(p.jetpackFuel*100)+'%';
  document.getElementById('jetpackFill').style.background=p.jetpackOn
    ?'linear-gradient(90deg,#f80,#f40)':'linear-gradient(90deg,#4af,#08f)';
}
function showOverlay(isDead){
  const ov=document.getElementById('overlay');
  ov.innerHTML=isDead?`
    <h1 style="color:#f44">GAME OVER</h1>
    <p style="font-size:22px;color:#ff9">Score: ${score}</p>
    <p style="font-size:14px;color:#aef">Floor reached: ${floor}</p>
    <button id="startBtn" style="padding:14px 40px;background:linear-gradient(135deg,#4af,#08f);color:#fff;border:none;border-radius:30px;font-size:18px;font-weight:bold;cursor:pointer" onclick="startGame()">PLAY AGAIN</button>
  `:`
    <h1>TOWER CLIMBER</h1>
    <div class="controls-hint">
      <div>ðŸ‘‰ Slide left/right â€” Move</div>
      <div>ðŸ‘‡ Pull down &amp; release â€” Jump</div>
      <div>ðŸ‘†ðŸ‘† Double tap â€” Jetpack</div>
    </div>
    <button id="startBtn" style="padding:14px 40px;background:linear-gradient(135deg,#4af,#08f);color:#fff;border:none;border-radius:30px;font-size:18px;font-weight:bold;cursor:pointer" onclick="startGame()">PLAY</button>
    <div class="hint">Collect coins â€¢ Avoid falling!</div>
  `;
  ov.style.display='flex';
}
function hideOverlay(){document.getElementById('overlay').style.display='none';}

function loop(){
  if(state!=='playing')return;
  update();drawBG();drawPlatforms();drawParticles();drawPlayer();drawPullIndicator();updateHUD();
  frameId=requestAnimationFrame(loop);
}
function startGame(){
  cancelAnimationFrame(frameId);
  score=0;floor=1;camY=0;particles=[];
  resetPlayer();generatePlatforms(H-60);
  state='playing';hideOverlay();loop();
}
showOverlay(false);
document.getElementById('startBtn').addEventListener('click',startGame);
</script>
</body>
</html>